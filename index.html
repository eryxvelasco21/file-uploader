<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzv9CrB4LdlZefX3t4z2uhbyltorMsC-8aCDy7SxjaDUrMeSkmBX0Vu-yjePDBto2Nu/exec';

  document.getElementById('uploadForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const fileInput = document.getElementById('fileInput');
    const description = document.getElementById('description').value;
    const file = fileInput.files[0];
    const statusDiv = document.getElementById('status');

    if (!file) {
      statusDiv.textContent = "Please select a file.";
      return;
    }

    const reader = new FileReader();
    reader.onload = async function(event) {
      const base64Data = event.target.result.split(',')[1];

      const payload = {
        fileName: file.name,
        mimeType: file.type,
        fileData: base64Data,
        description: description
      };

      statusDiv.innerHTML = "Uploading...";

      try {
        // ⚡ no headers → no preflight → no CORS error
        const response = await fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify(payload)
        });

        const text = await response.text(); // GAS sometimes returns as text
        let result;
        try { result = JSON.parse(text); } catch { result = { success:false, error:text }; }

        if (result.success) {
          statusDiv.innerHTML = `✅ File uploaded! <a href="${result.fileUrl}" target="_blank">View File</a>`;
        } else {
          statusDiv.innerHTML = `❌ Upload failed: ${result.error}`;
        }
      } catch (err) {
        statusDiv.innerHTML = `❌ Error: ${err.message}`;
      }
    };

    reader.readAsDataURL(file);
  });
</script>
